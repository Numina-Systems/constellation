# Human Test Plan — Web Tools

Generated: 2026-03-01
Design: docs/design-plans/2026-02-28-web-tools.md
Implementation: docs/implementation-plans/2026-03-01-web-tools/

## Automated Test Coverage

All 21 automatable acceptance criteria have passing tests:

| AC | Test File | Status |
|----|-----------|--------|
| web-tools.AC1.1–AC1.7 | src/web/providers/{brave,tavily,searxng,duckduckgo}.test.ts | Automated |
| web-tools.AC2.1–AC2.9 | src/web/fetch.test.ts | Automated |
| web-tools.AC3.1–AC3.4 | src/web/chain.test.ts | Automated |
| web-tools.AC4.1 | src/tool/builtin/web.test.ts | Automated |
| web-tools.AC4.2 | src/web/web.integration.test.ts | Automated |
| web-tools.AC4.3 | src/web/web.integration.test.ts | Automated |
| web-tools.AC5.1 | src/web/web.integration.test.ts | Automated |

## Manual Verification Required

The following 2 acceptance criteria require human verification because they exercise runtime behaviour that automated tests cannot fully cover.

---

### Test 1: web-tools.AC4.2 — Tools absent when config omitted

**Why manual:** The automated test covers the tool factory and registration logic, but the full composition root path through `main()` is only exercised at runtime. This verifies the actual daemon startup respects the conditional `if (config.web)` guard.

**Prerequisites:**
- PostgreSQL running (`docker compose up -d`)
- A `config.toml` that does NOT contain a `[web]` section

**Steps:**
1. Ensure `config.toml` has no `[web]` section (comment it out or remove it entirely)
2. Start the daemon: `bun run start`
3. At the REPL, ask the agent to list its available tools (or inspect startup logs)
4. Verify that neither `web_search` nor `web_fetch` appears in the tool list

**Expected:** No web tools registered. The agent has no awareness of web search or fetch capabilities.

**Cleanup:** Re-add `[web]` section to config.toml if it was removed.

---

### Test 2: web-tools.AC5.2 — Deno sandbox network permissions unchanged

**Why manual:** Web tools execute on the Bun host via tool handlers, never inside the Deno sandbox. The Deno sandbox only receives IPC stubs that call back to the host. No `--allow-net` flags are modified by web tool registration. This is structurally guaranteed by the architecture, but verifying actual Deno permission behaviour requires a running Deno subprocess with network access.

**Prerequisites:**
- PostgreSQL running (`docker compose up -d`)
- A `config.toml` with `[web]` section enabled (at minimum `[web]` with no API keys — DuckDuckGo is always available)
- `[runtime]` section with `allowed_hosts` configured (e.g., `allowed_hosts = ["example.com"]`)

**Steps:**

**Part A — With `[web]` section:**
1. Start the daemon with `[web]` section present: `bun run start`
2. Ask the agent to execute sandboxed code that fetches an allowed host:
   ```
   Run this code: await fetch("https://example.com")
   ```
3. Confirm the sandbox allows the fetch (returns a response)
4. Ask the agent to execute sandboxed code that fetches a denied host:
   ```
   Run this code: await fetch("https://not-allowed.example.org")
   ```
5. Confirm the sandbox blocks the fetch (permission denied error)

**Part B — Without `[web]` section:**
6. Remove or comment out the `[web]` section from config.toml
7. Restart the daemon: `bun run start`
8. Repeat steps 2–5

**Expected:** Identical Deno sandbox network permission behaviour in both Part A and Part B. The presence or absence of `[web]` config has zero effect on Deno's `--allow-net` / `--deny-net` flags.

---

## Summary

| Category | Count |
|----------|-------|
| Total acceptance criteria | 23 |
| Automated tests | 21 |
| Human verification | 2 |
| Dual coverage (automated + human) | 1 (AC4.2) |
